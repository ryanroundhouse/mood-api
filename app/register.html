<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Register - Moodful | Start Your Mood Tracking Journey</title>
    <meta
      name="description"
      content="Sign up for Moodful and begin your journey to better emotional well-being. Create your account to track moods, gain insights, and improve your mental health."
    />
    <meta
      name="keywords"
      content="Moodful, register, sign up, mood tracking, emotional well-being, mental health, account creation"
    />
    <meta name="robots" content="noindex, nofollow" />
    <meta
      property="og:title"
      content="Join Moodful - Start Your Emotional Well-being Journey"
    />
    <meta
      property="og:description"
      content="Create your Moodful account today and take the first step towards understanding and improving your emotional health through mood tracking."
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://moodful.ca/register.html" />
    <meta name="twitter:card" content="summary" />
    <meta
      name="twitter:title"
      content="Join Moodful - Start Your Emotional Well-being Journey"
    />
    <meta
      name="twitter:description"
      content="Create your Moodful account today and take the first step towards understanding and improving your emotional health through mood tracking."
    />
    <link rel="stylesheet" href="styles.css" />
    <style>
      /* Additional styles for the register page */
      .register-container {
        max-width: 400px;
        margin: 40px auto;
        padding: 20px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .register-container h2 {
        text-align: center;
        margin-bottom: 20px;
        color: #333;
      }
      .register-form label {
        display: block;
        margin-bottom: 5px;
        color: #555;
      }
      .register-form input {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      .register-form #card-element {
        margin-top: 20px;
        margin-bottom: 10px;
      }
      .register-form #card-errors {
        margin-top: 10px;
        margin-bottom: 20px;
        color: red;
      }
      .register-form button {
        width: 100%;
        padding: 12px;
        background: linear-gradient(135deg, #6a89cc, #b8e994);
        color: #fff;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        transition: opacity 0.3s ease;
      }
      .register-form button:hover {
        opacity: 0.9;
      }
      .login-link {
        text-align: center;
        margin-top: 15px;
      }
      .login-link a {
        color: #6a89cc;
        text-decoration: none;
      }
      .login-link a:hover {
        text-decoration: underline;
      }
      footer {
        background-color: #f8f8f8;
        padding: 20px 0;
        text-align: center;
      }
      footer ul {
        list-style-type: none;
        padding: 0;
        margin: 0;
      }
      footer ul li {
        display: inline;
        margin: 0 10px;
      }
      footer ul li a {
        text-decoration: none;
        color: #6a89cc;
        transition: color 0.3s ease;
      }
      footer ul li a:hover {
        color: #5a79bc;
      }
      .register-form .radio-group {
        display: flex;
        align-items: center;
        gap: 10px;
      }
    </style>
    <script src="https://js.stripe.com/v3/"></script>
  </head>
  <body>
    <header>
      <a href="index.html"><div class="logo">Moodful</div></a>
      <nav>
        <ul>
          <li><a href="features.html">Features</a></li>
          <li><a href="pricing.html">Pricing</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="login.html">Login</a></li>
        </ul>
      </nav>
    </header>

    <div class="register-container">
      <h2>Register</h2>
      <form id="registerForm" class="register-form">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required />

        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required />

        <label for="password">Password:</label>
        <input
          type="password"
          id="password"
          name="password"
          required
          minlength="6"
        />

        <label>Account Type:</label>
        <div class="radio-group">
          <input type="radio" id="free" name="accountType" value="free" />
          <label for="free">Free Account</label>
        </div>
        <div class="radio-group">
          <input type="radio" id="pro" name="accountType" value="pro" checked />
          <label for="pro">Pro Account</label>
        </div>

        <div id="payment-section">
          <div id="card-element">
            <!-- A Stripe Element will be inserted here. -->
          </div>
          <div id="card-errors" role="alert"></div>
        </div>

        <button type="submit">Register</button>
      </form>
      <div class="login-link">
        <p>Already have an account? <a href="login.html">Login here</a></p>
      </div>
    </div>

    <footer>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="features.html">Features</a></li>
        <li><a href="pricing.html">Pricing</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li><a href="privacy.html">Privacy Policy</a></li>
      </ul>
    </footer>

    <script>
      // Add this configuration object at the beginning of your script
      const config = {
        stripePublishableKey:
          window.location.hostname === 'localhost' ||
          window.location.hostname === '127.0.0.1'
            ? 'pk_test_51Q4MRsJCefXRKysVW9lkSu5vJ913qKJOerbHbkVXi03qknpd172AqT6sGmaDPf4Zp0DD8LBIuS1Qibq8YSTxbSW400vl4twH5X'
            : 'pk_live_51Q4MRsJCefXRKysVAmn5vPrGKbkAei95VaU91eeuV7pKrRnRfLHWq8f9I60ore0hb4XsoHfRCn4PsHQxsGif5YgV00eCcSUIOt',
      };

      // Replace the Stripe initialization with this:
      const stripe = Stripe(config.stripePublishableKey);
      const elements = stripe.elements();
      const card = elements.create('card');
      card.mount('#card-element');

      card.on('change', ({ error }) => {
        const displayError = document.getElementById('card-errors');
        if (error) {
          displayError.textContent = error.message;
        } else {
          displayError.textContent = '';
        }
      });

      document.querySelectorAll('input[name="accountType"]').forEach((elem) => {
        elem.addEventListener('change', (event) => {
          const paymentSection = document.getElementById('payment-section');
          if (event.target.value === 'pro') {
            paymentSection.style.display = 'block';
          } else {
            paymentSection.style.display = 'none';
          }
        });
      });

      let isSubmitting = false;

      function setFormDisabledState(isDisabled) {
        const formElements = document.querySelectorAll(
          '#registerForm input, #registerForm button'
        );
        formElements.forEach((element) => {
          element.disabled = isDisabled;
        });
      }

      document
        .getElementById('registerForm')
        .addEventListener('submit', async (event) => {
          event.preventDefault();

          if (isSubmitting) return; // Prevent multiple submissions
          isSubmitting = true;
          setFormDisabledState(true); // Disable form elements

          const name = document.getElementById('name').value;
          const email = document.getElementById('email').value;
          const password = document.getElementById('password').value;
          const accountType = document.querySelector(
            'input[name="accountType"]:checked'
          ).value;

          // Add password length validation
          if (password.length < 6) {
            alert('Password must be at least 6 characters long.');
            setFormDisabledState(false);
            isSubmitting = false;
            return;
          }

          let paymentMethodId = null;
          if (accountType === 'pro') {
            const { paymentMethod, error } = await stripe.createPaymentMethod({
              type: 'card',
              card: card,
              billing_details: {
                name: name,
                email: email,
              },
            });

            if (error) {
              const errorElement = document.getElementById('card-errors');
              errorElement.textContent = error.message;
              setFormDisabledState(false); // Re-enable form elements on error
              isSubmitting = false;
              return;
            } else {
              paymentMethodId = paymentMethod.id;
            }
          }

          const requestBody = {
            name,
            email,
            password,
            accountType,
          };

          if (paymentMethodId) {
            requestBody.paymentMethodId = paymentMethodId;
          }

          try {
            const response = await fetch('/register', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify(requestBody),
            });

            if (response.ok) {
              document.getElementById('registerForm').style.display = 'none';
              document.querySelector('.login-link').style.display = 'none';
              document.querySelector('.register-container h2').textContent =
                'Thanks for joining!';
              const confirmationMessage = document.createElement('p');
              confirmationMessage.textContent =
                'Please check your email to confirm your account creation.';
              document
                .querySelector('.register-container')
                .appendChild(confirmationMessage);
            } else {
              const errorData = await response.json();
              alert('Error: ' + errorData.error);
            }
          } catch (error) {
            console.error('Error during registration:', error);
            alert('An error occurred. Please try again.');
          } finally {
            setFormDisabledState(false); // Re-enable form elements after processing
            isSubmitting = false;
          }
        });

      // Initially hide the payment section if "Free Account" is selected
      if (
        document.querySelector('input[name="accountType"]:checked').value ===
        'free'
      ) {
        document.getElementById('payment-section').style.display = 'none';
      }
    </script>
  </body>
</html>
